<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Package Form Modal</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script crossorigin src="https://unpkg.com/@emotion/react@11.10.6/dist/emotion-react.umd.min.js"></script>
  <script crossorigin src="https://unpkg.com/@emotion/styled@11.10.6/dist/emotion-styled.umd.min.js"></script>
  <script crossorigin src="https://unpkg.com/@mui/material@5.11.0/umd/material-ui.development.js"></script>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body { margin: 16px; font-family: Roboto, sans-serif; }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel" data-presets="env,react">
    const { useState } = React;
    const {
      Button,
      Dialog,
      DialogTitle,
      DialogContent,
      DialogActions,
      TextField,
      FormControl,
      InputLabel,
      Select,
      MenuItem,
      Grid,
      IconButton,
      Box,
      Typography,
      Icon
    } = MaterialUI;

    function App() {
      const [open, setOpen] = useState(false);
      const [form, setForm] = useState({
        packageName: '',
        packageType: '',
        package: '',
        price: '',
        note: '',
        status: ''
      });
      const [meals, setMeals] = useState([]);
      const packageTypes = ['Type A', 'Type B', 'Type C'];
      const packages = ['Package 1', 'Package 2', 'Package 3'];
      const mealTypes = ['Breakfast', 'Lunch', 'Dinner'];
      const menuItems = ['Item 1', 'Item 2', 'Item 3'];

      const handleOpen = () => setOpen(true);
      const handleClose = () => setOpen(false);

      const handleFormChange = (e) => {
        const { name, value } = e.target;
        setForm((prev) => ({ ...prev, [name]: value }));
      };

      const addMeal = () => {
        setMeals((prev) => [
          ...prev,
          { id: Date.now(), mealType: '', menuItem: '' }
        ]);
      };

      const removeMeal = (id) => {
        setMeals((prev) => prev.filter((m) => m.id !== id));
      };

      const handleMealChange = (id, field, value) => {
        setMeals((prev) =>
          prev.map((m) => (m.id === id ? { ...m, [field]: value } : m))
        );
      };

      const selectedMealTypes = meals.map((m) => m.mealType).filter(Boolean);
      const selectedMenuItems = meals.map((m) => m.menuItem).filter(Boolean);

      return (
        <div>
          <Button variant="contained" onClick={handleOpen}>
            Open Package Form
          </Button>
          <Dialog open={open} onClose={handleClose} maxWidth="md" fullWidth>
            <DialogTitle>Package Form</DialogTitle>
            <DialogContent>
              <Grid container spacing={2}>
                <Grid item xs={12}>
                  <FormControl fullWidth margin="normal">
                    <TextField
                      label="Package Name"
                      name="packageName"
                      value={form.packageName}
                      onChange={handleFormChange}
                    />
                  </FormControl>
                  <FormControl fullWidth margin="normal">
                    <InputLabel>Package Type</InputLabel>
                    <Select
                      name="packageType"
                      value={form.packageType}
                      onChange={handleFormChange}
                    >
                      {packageTypes.map((type) => (
                        <MenuItem key={type} value={type}>
                          {type}
                        </MenuItem>
                      ))}
                    </Select>
                  </FormControl>
                  <FormControl fullWidth margin="normal">
                    <InputLabel>Package</InputLabel>
                    <Select
                      name="package"
                      value={form.package}
                      onChange={handleFormChange}
                    >
                      {packages.map((pkg) => (
                        <MenuItem key={pkg} value={pkg}>
                          {pkg}
                        </MenuItem>
                      ))}
                    </Select>
                  </FormControl>
                  <FormControl fullWidth margin="normal">
                    <TextField
                      type="number"
                      label="Price"
                      name="price"
                      value={form.price}
                      onChange={handleFormChange}
                    />
                  </FormControl>
                  <FormControl fullWidth margin="normal">
                    <TextField
                      label="Note (optional)"
                      name="note"
                      value={form.note}
                      onChange={handleFormChange}
                    />
                  </FormControl>
                  <FormControl fullWidth margin="normal">
                    <InputLabel>Status</InputLabel>
                    <Select
                      name="status"
                      value={form.status}
                      onChange={handleFormChange}
                    >
                      <MenuItem value="ACTIVE">ACTIVE</MenuItem>
                      <MenuItem value="INACTIVE">INACTIVE</MenuItem>
                      <MenuItem value="PENDING">PENDING</MenuItem>
                      <MenuItem value="ARCHIVE">ARCHIVE</MenuItem>
                    </Select>
                  </FormControl>
                </Grid>
                <Grid item xs={12}>
                  <Box display="flex" justifyContent="space-between" alignItems="center" mb={1}>
                    <Typography variant="h6">Meals</Typography>
                    <Button variant="outlined" onClick={addMeal}>
                      Add Meal
                    </Button>
                  </Box>
                  {meals.map((meal) => (
                    <Box key={meal.id} display="flex" alignItems="center" mb={1}>
                      <FormControl fullWidth margin="dense" sx={{ mr: 1 }}>
                        <InputLabel>Meal Type</InputLabel>
                        <Select
                          value={meal.mealType}
                          onChange={(e) => handleMealChange(meal.id, 'mealType', e.target.value)}
                        >
                          {mealTypes
                            .filter((mt) => !selectedMealTypes.includes(mt) || mt === meal.mealType)
                            .map((mt) => (
                              <MenuItem key={mt} value={mt}>
                                {mt}
                              </MenuItem>
                            ))}
                        </Select>
                      </FormControl>
                      <FormControl fullWidth margin="dense" sx={{ mr: 1 }}>
                        <InputLabel>Menu Item</InputLabel>
                        <Select
                          value={meal.menuItem}
                          onChange={(e) => handleMealChange(meal.id, 'menuItem', e.target.value)}
                        >
                          {menuItems
                            .filter((mi) => !selectedMenuItems.includes(mi) || mi === meal.menuItem)
                            .map((mi) => (
                              <MenuItem key={mi} value={mi}>
                                {mi}
                              </MenuItem>
                            ))}
                        </Select>
                      </FormControl>
                      <IconButton onClick={() => removeMeal(meal.id)}>
                        <Icon>close</Icon>
                      </IconButton>
                    </Box>
                  ))}
                </Grid>
              </Grid>
            </DialogContent>
            <DialogActions>
              <Button onClick={handleClose}>Cancel</Button>
              <Button variant="contained">Save</Button>
            </DialogActions>
          </Dialog>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
